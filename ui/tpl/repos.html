<button onclick="api_request('reloadrepos', false, function(response) {getRepoList()}) ">Reload</button>
<button onclick="api_request('getlogs', false, function(response) {console.log(response)}) ">Logs</button>

<table class="defaulttable">
    <thead>
        <th>Ident</th>
        <th>Name</th>
        <th>Version</th>
        <th>Author</th>
        <th>Path</th>
        <th>Running</th>
        <th>Standalone</th>
        <th>Start</th>
        <th>Stop</th>
        <th>Console</th>
        <th>Remove</th>
    </thead>
    <tbody id="repolist"></tbody>
</table>

<script>
        function getRepoList() {
            api_request('repolist', false, function(response) {
                console.log(response)
                var html = '';
                for (reponame in response.DATA) {
                    var repo = response.DATA[reponame];
                    path = repo.path.substring(repo.path.lastIndexOf('/') + 1)
                    html += '<tr>';
                        html += '<td>'+repo.config.app.ident+'</td>';
                        html += '<td>'+repo.config.app.name+'</td>';
                        html += '<td>'+repo.config.app.version+'</td>';
                        html += '<td>'+repo.config.info.author+'</td>';
                        html += '<td>'+path+'</td>';
                        html += '<td id="apprunning_'+repo.config.app.ident+'">'+repo.running+'</td>';
                        html += '<td>'+repo.config.app.standalone+'</td>';
                        html += '<td><button onclick="startRepo(\''+repo.name+'\')">Start</button></td>';
                        html += '<td><button onclick="stopRepo(\''+repo.name+'\')">Stop</button></td>';
                        html += '<td><button onclick="active_console=\''+repo.name+'\';ajax_load(\'content\',\'tpl/console.html\')">Console</button></td>';
                        html += '<td><button onclick="removeRepo(\''+repo.name+'\')">Remove</button></td>';
                    html += '</tr>';
                }
                $('#repolist').html(html);
            }) 
        }

        function startRepo(name) {
            api_request('execrepo', {'name': name}, function(response) {console.log(response)}) 
        }

        function stopRepo(name) {
            api_request('stoprepo', {'name': name}, function(response) {console.log(response)}) 
        }

        function removeRepo(name) {
            api_request('removerepo', {'name': name}, function(response) {getRepoList()}) 
        }

        getRepoList();
</script>

